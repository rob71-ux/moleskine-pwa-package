<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Una elegante agenda digitale ispirata ai classici taccuini Moleskine">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Moleskine">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23000'/><rect x='5' y='5' width='90' height='90' fill='none' stroke='%238B6F47' stroke-width='2'/><rect x='90' y='0' width='5' height='100' fill='%238B6F47'/><text x='50' y='65' font-family='serif' font-size='50' fill='%23F5F1E8' text-anchor='middle' font-weight='bold'>M</text></svg>">
    <title>Moleskine Digital - Agenda</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"><\/script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Crimson Text', serif; background: linear-gradient(135deg, #f5f1e8 0%, #e8e0d1 100%); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; }
.moleskine-container { width: 100%; max-width: 900px; }
.moleskine-cover { background: #000000; box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 50px rgba(255,255,255,0.05); border-radius: 12px 12px 0 0; padding: 2rem; text-align: center; position: relative; }
.moleskine-cover::after { content: ''; position: absolute; right: 20px; top: 0; bottom: 0; width: 3px; background: #8B6F47; }
.moleskine-cover h1 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: #F5F1E8; margin-bottom: 0.5rem; }
.moleskine-cover p { color: #E8E0D1; font-size: 0.875rem; }
.moleskine-page { background: #F5F1E8; background-image: repeating-linear-gradient(transparent, transparent 31px, #E8E0D1 31px, #E8E0D1 32px); box-shadow: inset 60px 0 0 -50px rgba(0,0,0,0.05), 0 2px 4px rgba(0,0,0,0.1), 0 10px 30px rgba(0,0,0,0.3); border-radius: 0 0 12px 12px; }
.dark .moleskine-page { background: #2C2416; background-image: repeating-linear-gradient(transparent, transparent 31px, #3D3526 31px, #3D3526 32px); }
.toolbar { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid #E8E0D1; flex-wrap: wrap; gap: 0.5rem; }
.dark .toolbar { border-bottom-color: #3D3526; }
.toolbar-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.btn { padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-family: 'Crimson Text', serif; font-size: 1rem; transition: all 0.3s ease; }
.btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-tool { background: #E8E0D1; color: #3D3526; }
.btn-tool.active { background: #3D3526; color: #F5F1E8; }
.btn-primary { background: #3D3526; color: #F5F1E8; }
.btn-danger { background: #dc2626; color: white; }
.content-area { padding: 2rem; }
.date { font-size: 0.875rem; color: #3D3526; margin-bottom: 1rem; }
.dark .date { color: #E8E0D1; }
.text-editor { width: 100%; height: 150px; padding: 1rem; background: transparent; border: 1px solid #E8E0D1; border-radius: 6px; font-family: 'Crimson Text', serif; font-size: 1.1rem; color: #3D3526; resize: vertical; margin-bottom: 1rem; line-height: 1.6; }
.dark .text-editor { border-color: #3D3526; color: #E8E0D1; }
.text-editor:focus { outline: none; border-color: #3D3526; }
.dark .text-editor:focus { border-color: #F5F1E8; }
.canvas-container { border: 1px solid #E8E0D1; border-radius: 6px; overflow: hidden; margin-bottom: 1rem; max-width: 100%; }
.dark .canvas-container { border-color: #3D3526; }
.canvas-wrapper { position: relative; width: 100%; max-width: 100%; }
#drawingCanvas { display: block; max-width: 100%; height: auto; }
.navigation { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-top: 1px solid #E8E0D1; flex-wrap: wrap; gap: 1rem; }
.dark .navigation { border-top-color: #3D3526; }
.page-info { color: #3D3526; display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
.dark .page-info { color: #E8E0D1; }
@media (max-width: 768px) {
    .moleskine-cover h1 { font-size: 2rem; }
    .toolbar, .navigation { flex-direction: column; align-items: stretch; }
    .toolbar-group { width: 100%; justify-content: center; }
    .btn { flex: 1; min-width: 100px; }
}
.install-prompt { position: fixed; bottom: 2rem; right: 2rem; background: #3D3526; color: #F5F1E8; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: none; align-items: center; gap: 1rem; z-index: 1000; }
.install-prompt.show { display: flex; }
.install-prompt button { background: #F5F1E8; color: #3D3526; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-family: 'Crimson Text', serif; }
    </style>
</head>
<body>
    <div class="moleskine-container">
        <div class="moleskine-cover">
            <h1>Moleskine</h1>
            <p>Digital Agenda</p>
        </div>
        <div class="moleskine-page" id="mainPage">
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="btn btn-tool active" id="btnPen" title="Penna">‚úèÔ∏è Penna</button>
                    <button class="btn btn-tool" id="btnEraser" title="Gomma">üßπ Gomma</button>
                    <button class="btn btn-tool" id="btnSelect" title="Seleziona">üëÜ Seleziona</button>
                    <button class="btn btn-tool" id="btnClear" title="Pulisci canvas">üóëÔ∏è Pulisci</button>
                </div>
                <div class="toolbar-group">
                    <button class="btn btn-primary" id="btnTheme" title="Cambia tema">üåô Tema</button>
                    <button class="btn btn-primary" id="btnExport" title="Esporta come immagine">üì• Esporta</button>
                </div>
            </div>
            <div class="content-area">
                <div class="date" id="currentDate"></div>
                <textarea class="text-editor" id="textEditor" placeholder="Scrivi qui le tue note..."></textarea>
                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="drawingCanvas" width="800" height="600"></canvas>
                    </div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-primary" id="btnPrev" disabled>‚Üê Precedente</button>
                <div class="page-info">
                    <span id="pageCounter">Pagina 1 di 1</span>
                    <button class="btn btn-primary" id="btnNew">+ Nuova</button>
                    <button class="btn btn-danger" id="btnDelete" style="display: none;">üóëÔ∏è Elimina</button>
                </div>
                <button class="btn btn-primary" id="btnNext" disabled>Successiva ‚Üí</button>
            </div>
        </div>
    </div>
    <div class="install-prompt" id="installPrompt">
        <span>Installa questa app sul tuo dispositivo!</span>
        <button id="btnInstall">Installa</button>
        <button id="btnDismiss" style="background: transparent; color: #F5F1E8;">‚úï</button>
    </div>
    <script>
const manifestData = {"name":"Moleskine Digital Agenda","short_name":"Moleskine","description":"Una elegante agenda digitale ispirata ai classici taccuini Moleskine","start_url":"./","display":"standalone","background_color":"#F5F1E8","theme_color":"#000000","icons":[{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAMAAABlApw1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJcEhZcwAACxMAAAsTAQCanBgAAAMAUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQh8twAAAP90Uk5TAAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6e3x9fn+AgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+6fG1KAAAB9ZJREFUeNrt3Xl8VNUdxvHvzGSyJ5CEEBJICEtYwr4oICCLgqCgqFhRtFqX1tbWutS1Vq21tbXVutZd61JFUXEBRQVZZBMQkH0HQkJCQvZ1Zu4fhNrSepN7Z+6dO3Pm/N73+Sd5n3PnJDNz7z1nAvj9fr/f7/f7/X6/3+/3+/0BAABA","sizes":"192x192","type":"image/png"},{"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAMAAABlApw1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJcEhZcwAACxMAAAsTAQCanBgAAAMAUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQh8twAAAP90Uk5TAAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6e3x9fn+AgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+6fG1KAAAB9ZJREFUeNrt3Xl8VNUdxvHvzGSyJ5CEEBJICEtYwr4oICCLgqCgqFhRtFqX1tbWutS1Vq21tbXVutZd61JFUXEBRQVZZBMQkH0HQkJCQvZ1Zu4fhNrSepN7Z+6dO3Pm/N73+Sd5n3PnJDNz7z1nAvj9fr/f7/f7/X6/3+/3+/0BAABA","sizes":"512x512","type":"image/png"}]};
const stringManifest=JSON.stringify(manifestData);
const blob=new Blob([stringManifest],{type:'application/json'});
const manifestURL=URL.createObjectURL(blob);
document.querySelector('head').insertAdjacentHTML('beforeend',`<link rel="manifest" href="${manifestURL}">`);
if('serviceWorker'in navigator&&location.protocol==='https:'){navigator.serviceWorker.register('sw.js').then(reg=>console.log('SW:',reg.scope)).catch(err=>console.log('SW:',err.message));}
let currentPageIndex=0,pages=[],fabricCanvas=null,currentTool='pen',isDark=false;
class Page{constructor(){this.id=Date.now().toString();this.date=new Date().toLocaleDateString('it-IT',{weekday:'long',year:'numeric',month:'long',day:'numeric'});this.text='';this.canvasState=null;this.createdAt=Date.now();}}
function init(){const saved=localStorage.getItem('moleskine-pages');if(saved){try{pages=JSON.parse(saved);}catch(e){pages=[new Page()];}}else{pages=[new Page()];}isDark=localStorage.getItem('moleskine-theme')==='dark';if(isDark){document.getElementById('mainPage').classList.add('dark');document.getElementById('btnTheme').textContent='‚òÄÔ∏è Tema';}fabricCanvas=new fabric.Canvas('drawingCanvas',{isDrawingMode:true,backgroundColor:'transparent'});fabricCanvas.freeDrawingBrush.width=2;fabricCanvas.freeDrawingBrush.color=isDark?'#E8E0D1':'#3D3526';loadPage(0);setupEventListeners();resizeCanvas();window.addEventListener('resize',resizeCanvas);setupInstallPrompt();}
function setupEventListeners(){document.getElementById('btnPen').addEventListener('click',()=>setTool('pen'));document.getElementById('btnEraser').addEventListener('click',()=>setTool('eraser'));document.getElementById('btnSelect').addEventListener('click',()=>setTool('select'));document.getElementById('btnClear').addEventListener('click',clearCanvas);document.getElementById('btnTheme').addEventListener('click',toggleTheme);document.getElementById('btnExport').addEventListener('click',exportAsImage);document.getElementById('btnPrev').addEventListener('click',()=>goToPage(currentPageIndex-1));document.getElementById('btnNext').addEventListener('click',()=>goToPage(currentPageIndex+1));document.getElementById('btnNew').addEventListener('click',addNewPage);document.getElementById('btnDelete').addEventListener('click',deletePage);document.getElementById('textEditor').addEventListener('input',(e)=>{pages[currentPageIndex].text=e.target.value;savePages();});fabricCanvas.on('object:modified',saveCurrentPage);fabricCanvas.on('path:created',saveCurrentPage);}
function setTool(tool){currentTool=tool;document.querySelectorAll('.btn-tool').forEach(btn=>btn.classList.remove('active'));switch(tool){case'pen':document.getElementById('btnPen').classList.add('active');fabricCanvas.isDrawingMode=true;fabricCanvas.freeDrawingBrush.width=2;fabricCanvas.freeDrawingBrush.color=isDark?'#E8E0D1':'#3D3526';break;case'eraser':document.getElementById('btnEraser').classList.add('active');fabricCanvas.isDrawingMode=true;fabricCanvas.freeDrawingBrush.width=20;fabricCanvas.freeDrawingBrush.color=isDark?'#2C2416':'#F5F1E8';break;case'select':document.getElementById('btnSelect').classList.add('active');fabricCanvas.isDrawingMode=false;break;}}
function clearCanvas(){if(confirm('Vuoi davvero pulire il canvas?')){fabricCanvas.clear();fabricCanvas.backgroundColor='transparent';saveCurrentPage();}}
function toggleTheme(){isDark=!isDark;const page=document.getElementById('mainPage');if(isDark){page.classList.add('dark');document.getElementById('btnTheme').textContent='‚òÄÔ∏è Tema';}else{page.classList.remove('dark');document.getElementById('btnTheme').textContent='üåô Tema';}localStorage.setItem('moleskine-theme',isDark?'dark':'light');if(currentTool==='pen'){fabricCanvas.freeDrawingBrush.color=isDark?'#E8E0D1':'#3D3526';}else if(currentTool==='eraser'){fabricCanvas.freeDrawingBrush.color=isDark?'#2C2416':'#F5F1E8';}}
function exportAsImage(){const dataURL=fabricCanvas.toDataURL({format:'png',quality:1});const link=document.createElement('a');link.download=`moleskine-${Date.now()}.png`;link.href=dataURL;link.click();}
function loadPage(index){if(index<0||index>=pages.length)return;saveCurrentPage();currentPageIndex=index;const page=pages[index];document.getElementById('textEditor').value=page.text;document.getElementById('currentDate').textContent=page.date;if(page.canvasState){fabricCanvas.loadFromJSON(page.canvasState,()=>{fabricCanvas.renderAll();});}else{fabricCanvas.clear();fabricCanvas.backgroundColor='transparent';}updateNavigation();}
function saveCurrentPage(){if(pages.length===0)return;pages[currentPageIndex].canvasState=fabricCanvas.toJSON();savePages();}
function savePages(){localStorage.setItem('moleskine-pages',JSON.stringify(pages));}
function addNewPage(){saveCurrentPage();pages.push(new Page());loadPage(pages.length-1);}
function deletePage(){if(pages.length<=1){alert('Non puoi eliminare l\'ultima pagina!');return;}if(confirm('Vuoi davvero eliminare questa pagina?')){pages.splice(currentPageIndex,1);const newIndex=Math.min(currentPageIndex,pages.length-1);savePages();loadPage(newIndex);}}
function goToPage(index){if(index>=0&&index<pages.length){loadPage(index);}}
function updateNavigation(){document.getElementById('pageCounter').textContent=`Pagina ${currentPageIndex+1} di ${pages.length}`;document.getElementById('btnPrev').disabled=currentPageIndex===0;document.getElementById('btnNext').disabled=currentPageIndex===pages.length-1;document.getElementById('btnDelete').style.display=pages.length>1?'inline-block':'none';}
function resizeCanvas(){const container=document.querySelector('.canvas-wrapper');const containerWidth=container.offsetWidth;const scale=containerWidth/800;fabricCanvas.setDimensions({width:800*scale,height:600*scale});fabricCanvas.setZoom(scale);}
function setupInstallPrompt(){let deferredPrompt;const installPrompt=document.getElementById('installPrompt');const btnInstall=document.getElementById('btnInstall');const btnDismiss=document.getElementById('btnDismiss');window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;if(localStorage.getItem('install-dismissed')!=='true'){installPrompt.classList.add('show');}});btnInstall.addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();const{outcome}=await deferredPrompt.userChoice;console.log(`User: ${outcome}`);deferredPrompt=null;installPrompt.classList.remove('show');});btnDismiss.addEventListener('click',()=>{installPrompt.classList.remove('show');localStorage.setItem('install-dismissed','true');});window.addEventListener('appinstalled',()=>{console.log('PWA installed!');installPrompt.classList.remove('show');});}
setInterval(()=>{saveCurrentPage();},30000);
window.addEventListener('beforeunload',()=>{saveCurrentPage();});
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}
    <\/script>
</body>
</html>